<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Board</title>
    <!-- Bootstrap CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">

    <style>
        html,
        body {
            height: 100%;
            margin: 0;
        }

        .full-height {
            height: 100%;
        }

        #activated-component {
          border: 2px solid green;
        }

        #board-column {
            width: 100%;
            height: 900px;
            border: 2px dashed #ccc;
            overflow: scroll;
            position: relative;
        }

        #board img {
          position: absolute;
          top: 10px;
          left: 10px;
        }

        #thumbnail-column {
          height: 900px;
            overflow-y: scroll; /* Enable vertical scrolling if needed */
        }

        #thumbnail-column img {
          max-height: 200px;
        }

    </style>
</head>

<body class="d-flex flex-column">
    <!-- Toolbar -->
    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">Papyrus Visualization</span>
            <div class="d-flex">
                <button class="btn btn-light me-2" onclick="openDialog()"><i class="fas fa-images"></i> Add Images</button>
                <div class="mx-2"></div>
                <button class="btn btn-light me-2" onclick="rotateLeft()"><i class="fas fa-undo-alt"></i> Rotate Left</button>
                <div class="mx-2"></div>
                <button class="btn btn-light me-2" onclick="rotateRight()"><i class="fas fa-redo-alt"></i> Rotate Right</button>
                <div class="mx-2"></div>
                <button class="btn btn-light me-2" onclick="zoomIn()"><i class="fas fa-search-plus"></i> Zoom In</button>
                <div class="mx-2"></div>
                <button class="btn btn-light me-2" onclick="zoomOut()"><i class="fas fa-search-minus"></i> Zoom Out</button>

            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-3 flex-grow-1">
      <div class="row h-100">

        <!-- Thumbnails Column -->
        <div id="thumbnail-column" class="col-md-2 full-height">
            <!-- <h5>Thumbnails</h5> -->
            <div id="thumbnail-container"></div>
        </div>
        <!-- Board Column -->
        <div id="board-column" class="col-md-10 full-height">
            <!-- <h5>Board</h5> -->
            <div id="board"></div>
        </div>
      </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');
        const fs = require('fs');

        ipcRenderer.on('selected-files', (event, files) => {
            const thumbnailContainer = document.getElementById('thumbnail-container');
            const board = document.getElementById('board');

            thumbnailContainer.innerHTML = ''; // Clear existing thumbnails

            files.forEach(file => {
                const thumbnail = new Image();
                thumbnail.src = 'file://' + file;
                thumbnail.className = 'img-thumbnail row';
                thumbnail.style.cursor = 'pointer';
                thumbnailContainer.appendChild(thumbnail);

                // Add click event listener to display full-size image
                thumbnail.addEventListener('dblclick', () => {
                  if (thumbnail.ref == undefined) {
                    const fullImage = new Image();
                    fullImage.src = 'file://' + file;
                    fullImage.className = 'img-fluid';
                    setActiveComponent(fullImage);
                    board.appendChild(fullImage);
                    thumbnail.ref = fullImage;
                    dragElement(fullImage);
                    fullImage.addEventListener('click', () => {
                      setActiveComponent(fullImage);
                    })
                  } else {
                    setActiveComponent(thumbnail.ref);
                  }
                });
            });
        });
        
        function setActiveComponent(comp) {
          prevActiv = getActiveComponent();
          if (prevActiv != null) {
              prevActiv.setAttribute('id', '');
          }
          comp.setAttribute('id', 'activated-component');
        }

        function getActiveComponent() {
            return document.getElementById('activated-component');
        }

        function openDialog() {
            ipcRenderer.send('open-file-dialog');
        }

        function rotateLeft() {
          const image = getActiveComponent()
          if (image) {
            const rotation = parseInt(image.dataset.rotation || 0) - 5;
            const scale = parseFloat(image.dataset.scale || 1);
            image.style.transform = `scale(${scale}) rotate(${rotation}deg)`;
            image.dataset.rotation = rotation;
          }
        }

        function rotateRight() {
          const image = getActiveComponent()
          if (image) {
            const rotation = parseInt(image.dataset.rotation || 0) + 5;
            const scale = parseFloat(image.dataset.scale || 1);
            image.style.transform = `scale(${scale}) rotate(${rotation}deg)`;
            image.dataset.rotation = rotation;
          }
        }

        function zoomIn() {
          const image = getActiveComponent()
          if (image) {
            const rotation = parseInt(image.dataset.rotation || 0);
            const scale = parseFloat(image.dataset.scale || 1) + 0.1;
            image.style.transform = `scale(${scale}) rotate(${rotation}deg)`;

            image.dataset.scale = scale;
          }
        }

        function zoomOut() {
          const image = getActiveComponent()
          if (image) {
            const rotation = parseInt(image.dataset.rotation || 0);
            const scale = parseFloat(image.dataset.scale || 1) - 0.1;
            image.style.transform = `scale(${scale}) rotate(${rotation}deg)`;
            image.dataset.scale = scale;
          }
        }

        function dragElement(elmnt) {
          var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
          elmnt.onmousedown = dragMouseDown;

          function dragMouseDown(e) {
            e = e || window.event;
            e.preventDefault();
            // get the mouse cursor position at startup:
            pos3 = e.clientX;
            pos4 = e.clientY;
            document.onmouseup = closeDragElement;
            // call a function whenever the cursor moves:
            document.onmousemove = elementDrag;
          }

          function elementDrag(e) {
            e = e || window.event;
            e.preventDefault();
            // calculate the new cursor position:
            pos1 = pos3 - e.clientX;
            pos2 = pos4 - e.clientY;
            pos3 = e.clientX;
            pos4 = e.clientY;
            // set the element's new position:
            elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
            elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
            elmnt.style.cursor = "move";
          }

          function closeDragElement() {
            /* stop moving when mouse button is released:*/
            document.onmouseup = null;
            document.onmousemove = null;
            elmnt.style.cursor = "unset";
          }
        }

        function arrangeImages() {
            // Implement image arrangement functionality
        }
    </script>
</body>